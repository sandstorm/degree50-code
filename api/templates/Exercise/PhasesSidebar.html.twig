{% trans_default_domain 'forms' %}

<div class="sidebar__group">
        <p>
            {{ _self.sidebarLink(exercise.course.name, false, '', path('exercise-overview', {id: exercise.course.id})) }}
        </p>
        <p>
            {{ _self.sidebarLink(exercise.name, false, '', path('exercise-overview__exercise--show-overview', {id: exercise.id})) }}
        </p>
    <header id="heading-phases">
        <h5>
            Phasen
        </h5>
    </header>
    <div id="collapse-phases" class="collapse show" aria-labelledby="heading-phases" data-parent="#sidebar">
        <div class="sidebar__group-body">
            <ul class="list">
                {% for item in sidebarItems %}
                    <li class="sidebar-item {{ (item.phase.id == currentItemId) ? 'sidebar-item--active' : '' }} {{ is_granted('viewExercisePhase', item.phase) ? "" : "sidebar-item--disabled" }}" data-test-id="exercisePhaseSidebarItem">
                        {% if showSolution %}
                            {{
                                _self.sidebarLink(
                                    item.phase.name,
                                    item.phase.dependsOnExercisePhase != null,
                                    item.phase.isGroupPhase ? 'fas fa-users' : 'fas fa-user',
                                    path(
                                        'exercise-overview__exercise-phase--show-solutions',
                                        {id: exercise.id, phase_id: item.phase.id}
                                    ),
                                    true,
                                    item.metadata.isDone,
                                    item.metadata.needsReview,
                                )
                            }}
                        {% else %}
                            {{
                                _self.sidebarLink(
                                    item.phase.name,
                                    item.phase.dependsOnExercisePhase != null,
                                    item.phase.isGroupPhase ? 'fas fa-users' : 'fas fa-user',
                                    path(
                                        'exercise-overview__exercise--show-phase-overview',
                                        {id: exercise.id, phaseId: item.phase.id}
                                    ),
                                    is_granted('viewExercisePhase', item.phase),
                                    item.metadata.isDone,
                                    item.metadata.needsReview
                                )
                            }}
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>



{% macro sidebarLink(name, doesDependOnExercisePhase, iconClass, href, canView = true, isDone = false, reviewRequired = false)  %}
    <a
        class="nav-link"
        {% if canView %} href="{{ href }}" {% endif %}
    >
        <i class="{{ iconClass }}"></i>
        {% if doesDependOnExercisePhase %}
            <i class="fas fa-arrow-up"
               title="{% trans %}exercisePhase.labels.dependsOnPreviousPhase{% endtrans %}"></i>
        {% endif %}
        {{ name }}
        {% if reviewRequired %}
            <i class="fa-regular fa-circle-exclamation" title="{{ 'exercise.labels.reviewRequired' | trans }}"></i>
        {% elseif isDone %}
            <i class="fa-regular fa-check" title="{{ 'exercise.labels.phaseDone' | trans }}"></i>
        {% endif %}
    </a>
{% endmacro %}
