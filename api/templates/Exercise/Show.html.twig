{% extends 'BaseFullscreen.html.twig' %}

{% block title %}{{ exercise.name }}{% endblock %}

{% block body %}
    <div class="container">
        <h2 class="text-center">Phase {{ currentPhase + 1 }}: {{ phase.name }}</h2>
        <p class="text-center"><strong>{% if phase.isGroupPhase %}In Gruppen{% else %}Alleine{% endif %}</strong></p>
        <p class="text-center text-small">
            {{ phase.task }}
        </p>
        <hr />
        {% if phase.isGroupPhase %}
            <h4>Bestehende Gruppen</h4>
            <p>Tritt einer Gruppe bei um die Aufgabe zu bearbeiten oder erstelle eine neue Gruppe.</p>

            <div class="row">
                <div class="col-3">
                    {% if is_granted('create', phase) %}
                        <div tabindex="0" class="tile tile--active" >
                            <a class="tile__content" href="{{ path('app_exercise-phase-team-new', {id: phase.id}) }}">
                                <i class="tile__icon fas fa-plus-circle"></i>
                                <span>Neue Gruppe anlegen</span>
                            </a>
                        </div>
                    {% else %}
                        <div tabindex="0" class="tile tile--active tile--disabled" >
                            <div class="tile__content">
                                <i class="tile__icon fas fa-plus-circle"></i>
                                <span>Neue Gruppe anlegen</span>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="col-9">
                    <div class="tiles">
                        {% for team in phase.teams %}
                            <div tabindex="0" class="tile tile--with-extension tile--active">
                                <div class="tile__content">
                                    <i class="tile__icon fas fa-users"></i>
                                    <span>Gruppe von {{ team.creator.username }}</span>
                                </div>
                                <div class="tile__extension">
                                    <div class="tile__extension-content">
                                        <strong>Mitglider:</strong> <br />
                                        {% for member in team.members %}
                                            {{ member.username }} <br />
                                        {% endfor %}
                                    </div>
                                    <div class="tile__extension-actions">
                                        {% if is_granted('join', team) %}
                                            <a class="btn btn-primary btn-sm" href="{{ path('app_exercise-phase-team-join', { 'id':phase.id, 'team_id': team.id }) }}">Gruppe beitreten</a>
                                        {% endif %}
                                        {% if is_granted('leave', team) %}
                                            <a class="btn btn-outline-primary btn-sm" href="{{ path('app_exercise-phase-team-leave', { 'id':phase.id, 'team_id': team.id }) }}">Gruppe verlassen</a>
                                        {% endif %}
                                        {% if is_granted('show', team) %}
                                            <a class="btn btn-primary btn-sm" href="{{ path('app_exercise-phase-show', { 'id':phase.id, 'team_id': team.id }) }}">Phase starten</a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

        {% else %}
            <h4>Bisherigen Ergebnisse deiner Seminargruppe: </h4>
            <div class="tiles">
                {% if is_granted('create', phase) %}
                    <div tabindex="0" class="tile tile--active" >
                        <a class="tile__content" href="{{ path('app_exercise-phase-team-new', {id: phase.id}) }}">
                            <i class="tile__icon fas fa-play"></i>
                            <span>Phase starten</span>
                        </a>
                    </div>
                {% endif %}

                {% for team in phase.teams %}
                    {% if team.creator == app.user %}
                        <div tabindex="0" class="tile tile--active" >
                            <a class="tile__content" href="{{ path('app_exercise-phase-show', { 'id':phase.id, 'team_id': team.id }) }}">
                                <i class="tile__icon fas fa-play"></i>
                                <span>Mein Ergebnis</span>
                            </a>
                        </div>
                    {% else %}
                        <div tabindex="0" class="tile" >
                            <a class="tile__content" href="{{ path('app_exercise-phase-show', { 'id':phase.id, 'team_id': team.id }) }}">
                                <i class="tile__icon fas fa-user"></i>
                                <span>{{ team.creator.username }}</span>
                            </a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    {{ include('Exercise/Footer.html.twig', {exercise: exercise, exercisePhase: phase, currentPhaseIndex: currentPhase, amountOfPhases: amountOfPhases}) }}

{% endblock %}
